webpackJsonp([24],{Azpr:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("fZjL"),i=a.n(s),o={data:function(){var t=new Date;return{curdate:t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate(),showDiy:!1,addData:{brandname:"",coupontype:1,minprice:0,couponmodel:1,cutprice:0,maxnum:0,couponscene:5,couponscope:1,usertype:1,duration:1,remark:"",couponnum:1,price:0,isissued:0,expiretimes:1,uselimit:1},diyCouponname:"",diyRemark:"",chosedCate:[],chosedItem:[],couponcateids:[],couponitemids:[],cateList:[],rules:{brandname:[{required:!0,message:"请输入券中店铺简称",trigger:"blur"}]},typeMap:[{key:1,value:"满减券"},{key:2,value:"代金券"},{key:3,value:"月券（每月使用限制）"}],userMap:[{key:1,value:"所有用户"},{key:2,value:"新注册用户"}],modelMap:[{key:1,value:"抵扣"},{key:2,value:"折扣",disabled:!0}],sceneMap:[{key:1,value:"新用户注册"},{key:5,value:"会员礼包"},{key:6,value:"扫码领券"}],scopeMap:[{key:1,value:"全场通用"},{key:2,value:"部分品类"},{key:3,value:"部分商品"}]}},mounted:function(){this.$sitemap.prvname="优惠券",this.$sitemap.currname="新增优惠券",this.getCategoryList()},methods:{handleSubmit:function(){var t=this,e=!0;if(this.$refs.couponAdd.validate(function(t){e=t}),this.$refs.right.validate(function(t){t||(e=!1)}),e){var a=this.addData;if(1==a.coupontype&&a.minprice<=0)this.$Message.error("满减券满减金额必须大于0");else if(3==a.coupontype&&a.uselimit<1)this.$Message.error("每月限制使用张数最少为1");else if(2==a.couponscene&&a.price<=0)this.$Message.error("优惠券购买金额必须大于0");else if(a.cutprice<=0)this.$Message.error("优惠券金额必须大于0");else if(2!=a.couponscope||this.chosedCate.length)if(3!=a.couponscope||this.chosedItem.length)if(a.couponnum<=0)this.$Message.error("发放数量不能为0");else{var s=this.formatParams();this.$http.post(this.$api.coupon_add,s).then(function(e){"1"==e.data.result?(t.$Message.success("创建成功！"),t.$router.push("/coupon/list")):t.$Message.error(e.data.msg)}).catch(function(e){t.$Message.error("网络请求错误！")})}else this.$Message.error("请选择适用的商品");else this.$Message.error("请选择适用的商品分类")}},formatParams:function(){var t=this,e=this.addData,a={};return i()(e).forEach(function(s){"couponscope"==s?(2==e[s]?a.couponcateids=t.chosedCate.join(","):3==e[s]&&(a.couponitemids=t.chosedItem.join(",")),a[s]=e[s]):"expiretimes"==s?1==e.isissued&&(a[s]=e[s]):"price"==s?(2!=e.couponscene&&(e[s]=0),a[s]=e[s]):"minprice"==s?(1!=e.coupontype&&(e[s]=0),a[s]=e[s]):"uselimit"==s?3==e.coupontype&&(a[s]=e[s]):a[s]=e[s]}),a.remark=this.remark,a.couponname=this.couponname,a},getCategoryList:function(){var t=this,e=this;this.$http.post(this.$api.category_list,{parentid:0}).then(function(a){"1"==a.data.result?e.cateList=a.data.data?a.data.data:[]:t.$Message.error(a.data.msg)}).catch(function(e){t.$Message.error("系统错误")})},handleCateChange:function(t){}},computed:{preTitle:function(){var t=this.addData.coupontype;return this.typeMap.find(function(e){return e.key==t}).value},couponname:function(){return this.diyCouponname||this.preTitle},remarkTitle:function(){var t=this.addData.usertype;return 1==t?"消费金额":2==t?"首单":void 0},remarkMid:function(){var t=this.addData.minprice,e=this.addData.cutprice||"xxx";return 0==+t?"立减"+e+"元":"满"+t+"可用"},enddate:function(){if(this.addData.expiretimes){var t=isNaN(this.addData.expiretimes)?-1:+this.addData.expiretimes;if(t<0)return"日期错误";var e=new Date(Date.parse(this.curdate)+24*t*3600*1e3);return e=e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()}return"xxx"},needLimited:function(){return!0},remark:function(){return this.diyRemark?this.diyRemark:this.remarkTitle+this.remarkMid}}},n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{padding:"10px"}},[a("div",{staticClass:"coupon-main"},[a("div",{staticClass:"coupon-edit"},[a("Form",{ref:"couponAdd",attrs:{model:t.addData,"label-position":"left",rules:t.rules,"label-width":120}},[a("FormItem",{attrs:{label:"优惠券类型"}},[a("Select",{staticStyle:{width:"300px"},model:{value:t.addData.coupontype,callback:function(e){t.$set(t.addData,"coupontype",e)},expression:"addData.coupontype"}},t._l(t.typeMap,function(e){return a("Option",{key:e.key,attrs:{value:e.key,disabled:!!e.disabled}},[t._v(t._s(e.value))])}))],1),t._v(" "),3==t.addData.coupontype?a("FormItem",{attrs:{label:"每月限使用（张）"}},[a("InputNumber",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入数量",min:1},model:{value:t.addData.uselimit,callback:function(e){t.$set(t.addData,"uselimit",e)},expression:"addData.uselimit"}})],1):t._e(),t._v(" "),a("FormItem",{attrs:{label:"适用范围"}},[a("Select",{staticStyle:{width:"300px"},model:{value:t.addData.couponscope,callback:function(e){t.$set(t.addData,"couponscope",e)},expression:"addData.couponscope"}},t._l(t.scopeMap,function(e){return a("Option",{key:e.key,attrs:{value:e.key,disabled:!!e.disabled}},[t._v(t._s(e.value))])})),t._v(" "),2==t.addData.couponscope?a("div",[t._v("\n\t\t\t\t        \t请选择商品分类："),a("Select",{staticStyle:{width:"300px"},attrs:{multiple:""},on:{"on-change":t.handleCateChange},model:{value:t.chosedCate,callback:function(e){t.chosedCate=e},expression:"chosedCate"}},t._l(t.cateList,function(e){return a("Option",{key:e.id,attrs:{value:e.id}},[t._v("\n\t\t\t\t        \t\t\t"+t._s(e.catename)+"\n\t\t\t\t        \t\t")])}))],1):t._e(),t._v(" "),3==t.addData.couponscope?a("div",[a("multi-item-select",{model:{value:t.chosedItem,callback:function(e){t.chosedItem=e},expression:"chosedItem"}})],1):t._e()],1),t._v(" "),a("FormItem",{attrs:{label:"适用人群"}},[a("RadioGroup",{model:{value:t.addData.usertype,callback:function(e){t.$set(t.addData,"usertype",e)},expression:"addData.usertype"}},t._l(t.userMap,function(e){return a("Radio",{key:e.key,staticStyle:{"margin-right":"20px"},attrs:{label:e.key}},[t._v(t._s(e.value))])}))],1),t._v(" "),a("FormItem",{attrs:{label:"获取方式"}},[a("Select",{staticStyle:{width:"300px"},model:{value:t.addData.couponscene,callback:function(e){t.$set(t.addData,"couponscene",e)},expression:"addData.couponscene"}},t._l(t.sceneMap,function(e){return a("Option",{key:e.key,attrs:{value:e.key,disabled:!!e.disabled}},[t._v(t._s(e.value))])}))],1),t._v(" "),2==t.addData.couponscene?a("FormItem",{attrs:{label:"购券价格（元）"}},[a("InputNumber",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入优惠券价格",min:0},model:{value:t.addData.price,callback:function(e){t.$set(t.addData,"price",e)},expression:"addData.price"}})],1):t._e(),t._v(" "),a("FormItem",{attrs:{label:"满减金额"}},[1==t.addData.coupontype?a("div",[t._v("\n\t\t\t\t\t\t\t满 "),a("InputNumber",{staticStyle:{width:"200px"},attrs:{min:0},model:{value:t.addData.minprice,callback:function(e){t.$set(t.addData,"minprice",e)},expression:"addData.minprice"}}),t._v(" 元可用\n\t\t\t\t\t\t")],1):a("div",{staticStyle:{color:"#3bc0c3"}},[t._v("\n\t\t\t\t\t\t\t无限制\n\t\t\t\t\t\t")])]),t._v(" "),a("FormItem",{attrs:{label:"优惠方式"}},[a("RadioGroup",{model:{value:t.addData.couponmodel,callback:function(e){t.$set(t.addData,"couponmodel",e)},expression:"addData.couponmodel"}},t._l(t.modelMap,function(e){return a("Radio",{key:e.key,staticStyle:{"margin-right":"20px"},attrs:{label:e.key,disabled:!!e.disabled}},[t._v(t._s(e.value))])}))],1),t._v(" "),2==t.addData.couponmodel?a("FormItem",{attrs:{label:"折扣（%）"}},[a("Input",{staticStyle:{width:"200px"},attrs:{placeholder:"0-100的数字，20代表8折"},model:{value:t.addData.cutprice,callback:function(e){t.$set(t.addData,"cutprice",e)},expression:"addData.cutprice"}})],1):t._e(),t._v(" "),1==t.addData.couponmodel?a("FormItem",{attrs:{label:"优惠金额（元）"}},[a("InputNumber",{staticStyle:{width:"200px"},attrs:{placeholder:"优惠券能金额",min:0},model:{value:t.addData.cutprice,callback:function(e){t.$set(t.addData,"cutprice",e)},expression:"addData.cutprice"}})],1):t._e(),t._v(" "),a("FormItem",{attrs:{label:"有效时长（天）"}},[a("InputNumber",{staticStyle:{width:"200px"},attrs:{placeholder:"优惠券的有效期",min:0},model:{value:t.addData.duration,callback:function(e){t.$set(t.addData,"duration",e)},expression:"addData.duration"}}),t._v(" "),a("span",{staticStyle:{"margin-left":"10px",color:"#ccc","font-size":"14px"}},[t._v("领券后多少天内可用，0代表不限制")])],1),t._v(" "),a("FormItem",{attrs:{label:"每人限领（张）"}},[a("InputNumber",{staticStyle:{width:"200px"},attrs:{min:0},model:{value:t.addData.maxnum,callback:function(e){t.$set(t.addData,"maxnum",e)},expression:"addData.maxnum"}}),a("span",{staticStyle:{"margin-left":"10px",color:"#ccc","font-size":"14px"}},[t._v("0代表不限制每人张数")])],1),t._v(" "),a("FormItem",{attrs:{label:"发放总数（张）"}},[a("InputNumber",{staticStyle:{width:"200px"},attrs:{min:1},model:{value:t.addData.couponnum,callback:function(e){t.$set(t.addData,"couponnum",e)},expression:"addData.couponnum"}})],1),t._v(" "),a("FormItem",{attrs:{label:"是否立即投放"}},[a("RadioGroup",{model:{value:t.addData.isissued,callback:function(e){t.$set(t.addData,"isissued",e)},expression:"addData.isissued"}},[a("Radio",{staticStyle:{"margin-right":"20px"},attrs:{label:0}},[t._v("暂不投放")]),t._v(" "),a("Radio",{staticStyle:{"margin-right":"20px"},attrs:{label:1}},[t._v("立即投放")])],1)],1),t._v(" "),1==t.addData.isissued?a("FormItem",{attrs:{label:"活动时长"}},[a("InputNumber",{staticStyle:{width:"200px"},attrs:{min:1},model:{value:t.addData.expiretimes,callback:function(e){t.$set(t.addData,"expiretimes",e)},expression:"addData.expiretimes"}}),t._v(" "),a("span",{staticStyle:{"margin-left":"10px",color:"#ccc","font-size":"14px"}},[t._v("优惠券投放天数，最小为1")])],1):t._e(),t._v(" "),a("FormItem",[a("Button",{attrs:{type:"primary"},on:{click:t.handleSubmit}},[t._v("提交保存")])],1)],1)],1),t._v(" "),a("div",{staticClass:"coupon-preview"},[a("div",{staticClass:"preview-card"},[a("div",{staticClass:"card-left"},[a("img",{staticClass:"card-jc",attrs:{src:"/static/images/card-jc.png"}}),t._v(" "),t.addData.brandname?a("div",{staticClass:"card-name col"},[t._v(t._s(t.addData.brandname))]):a("div",{staticClass:"card-name col",staticStyle:{border:"1px dashed",color:"#ccc"}},[t._v("店铺简称")]),t._v(" "),a("div",{staticClass:"card-money col"},[a("span",{staticStyle:{"font-size":"18px"}},[t._v("￥")]),t._v(" "),t.addData.cutprice?a("span",[t._v("\t"+t._s(t.addData.cutprice))]):a("span",{staticStyle:{border:"1px dashed",color:"#ccc","font-size":"14px"}},[t._v("优惠金额\t")])]),t._v(" "),a("div",{staticClass:"card-status col"},[t._v("未使用")])]),t._v(" "),a("div",{staticClass:"card-right"},[a("div",{staticClass:"right-title col"},[t._v(t._s(t.couponname))]),t._v(" "),a("div",{staticClass:"right-desc col"},[a("span",[t._v(t._s(t.remark))])]),t._v(" "),t._m(0)])]),t._v(" "),a("div",[a("Form",{ref:"right",attrs:{"label-position":"left",rules:t.rules,"label-width":120,model:t.addData}},[a("FormItem",{attrs:{label:"店铺简称",prop:"brandname"}},[a("Input",{staticStyle:{width:"200px"},model:{value:t.addData.brandname,callback:function(e){t.$set(t.addData,"brandname","string"==typeof e?e.trim():e)},expression:"addData.brandname"}})],1),t._v(" "),a("FormItem",{attrs:{label:"优惠券名称"}},[a("Input",{staticStyle:{width:"200px"},model:{value:t.diyCouponname,callback:function(e){t.diyCouponname="string"==typeof e?e.trim():e},expression:"diyCouponname"}})],1),t._v(" "),a("FormItem",{attrs:{label:"优惠券副标题"}},[a("Input",{staticStyle:{width:"200px"},attrs:{readonly:""},model:{value:t.remark,callback:function(e){t.remark=e},expression:"remark"}}),t._v(" "),a("Button",{attrs:{size:"small"},on:{click:function(e){t.showDiy=!t.showDiy}}},[t._v(t._s(t.showDiy?"取消":"自定义"))])],1),t._v(" "),t.showDiy?a("FormItem",[a("Input",{staticStyle:{width:"200px"},model:{value:t.diyRemark,callback:function(e){t.diyRemark=e},expression:"diyRemark"}}),t._v(" "),a("Button",{attrs:{size:"small"}},[t._v("确定")]),a("Button",{staticStyle:{"margin-left":"5px"},attrs:{size:"small"}},[t._v("清空")])],1):t._e()],1)],1)])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"right-expires col"},[e("span",[this._v("xxx")]),this._v("至"),e("span",[this._v("xxx")]),this._v("有效")])}]};var r=a("VU/8")(o,n,!1,function(t){a("Je5+")},null,null);e.default=r.exports},"Je5+":function(t,e){}});
//# sourceMappingURL=24.6169ff109db4591d1e89.js.map