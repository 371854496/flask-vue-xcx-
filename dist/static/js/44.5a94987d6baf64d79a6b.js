webpackJsonp([44],{SuEJ:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={data:function(){return{page:{pagesize:10,pageindex:0,activeTab:"0"},loading:!1,columns:[],listData:[],totalcount:0,typeMap:[{key:1,value:"满减券"},{key:2,value:"代金券"},{key:3,value:"月券"}],userMap:[{key:1,value:"所有用户"},{key:2,value:"新注册用户"}],modelMap:[{key:1,value:"抵扣"},{key:2,value:"折扣",disabled:!0}],sceneMap:[{key:5,value:"会员礼包"},{key:6,value:"扫码领券"}],scopeMap:[{key:1,value:"全场通用"},{key:2,value:"部分品类"},{key:3,value:"部分商品",disabled:!0}],expiretimes:1,showConfirm:!1,showText:"",updateForm:{expiretimes:1},wxImg:"",loadBol:!1}},mounted:function(){this.$sitemap.prvname="优惠券",this.$sitemap.currname="优惠券列表",this.$menuactive.open=["SalesBlock"],this.$menuactive.active="CouponList",this.getCouponList(),this.initHeader()},watch:{page:{handler:function(e){this.getItemList()},deep:!0}},methods:{handleGoAdd:function(){this.$router.push({name:"CouponAdd"})},getCouponList:function(){var e=this;this.$http.post(this.$api.coupon_list,this.page).then(function(t){"1"==t.data.result?(e.listData=t.data.data,e.totalcount=+t.data.totalcount):that.$Message.error(t.data.msg)}).catch(function(e){that.$Message.error("服务器异常")})},indexChange:function(e){this.page.pageindex=e-1},sizeChange:function(e){this.page.pagesize=e},initHeader:function(){var e=this;this.columns=[{title:"优惠券名称",key:"couponname",align:"center",minWidth:200},{title:"优惠券副标题",key:"remark",align:"center",minWidth:200},{title:"类型",key:"coupontype",align:"center",width:100,render:function(t,i){var n=e.typeMap.find(function(e){return e.key==i.row.coupontype});return t("span",n?n.value:"-")}},{title:"优惠金额",key:"cutprice",align:"center",width:100},{title:"领券方式",key:"couponscene",align:"center",width:100,render:function(t,i){var n=e.sceneMap.find(function(e){return e.key==i.row.couponscene});return t("span",n?n.value:"-")}},{title:"适用用户",key:"usertype",align:"center",width:100,render:function(t,i){var n=e.userMap.find(function(e){return e.key==i.row.usertype});return t("span",n?n.value:"-")}},{title:"投放状态",key:"isissued",align:"center",width:100,render:function(e,t){return e("span",{style:{color:"#3bc0c3"}},1==t.row.isissued?"已投放":"未投放")}},{title:"操作",key:"operate",align:"center",width:150,render:function(t,i){var n=t("Button",{props:{type:"primary",size:"small"},on:{click:function(){e.showConfirm=!0,e.showText=1!=i.row.isissued?"":"确认停止投放吗?",i.row.isissued?e.updateForm={merid:i.row.merid,couponid:i.row.id,isissued:0,expiretimes:0}:e.updateForm={merid:i.row.merid,couponid:i.row.id,isissued:1,expiretimes:1}}}},1!=i.row.isissued?"投放":"停止"),a="";return 6==i.row.couponscene&&(a=t("Button",{props:{type:"ghost",size:"small"},on:{click:function(){e.loadFile(i.row.id)}},style:{marginLeft:"5px"}},"分享码")),t("div",[n,a])}}]},updateConfirm:function(){var e=this,t=e.$api.coupon_editisissued;e.$http.post(t,e.updateForm).then(function(t){1==t.data.result?(e.$Message.success("更新成功!"),e.getCouponList()):e.$Message.error(t.data.msg)}).catch(function(t){e.$Message.error("服务器异常")})},loadFile:function(e){var t=this,i={path:"pages/receive/index",couponid:e};this.$Message.loading({content:"加载中...",duration:10}),this.$http.post(this.$api.wxa_getqrcode,i).then(function(e){e.data.result?(t.wxImg=e.data.data,t.loadBol=!0,t.$Message.destroy()):t.$Message.error(e.data.msg)}).catch(function(){t.$Message.error("服务器异常")})},down:function(){var e=document.createElement("a"),t=new MouseEvent("click");e.download="分享码",e.href=this.wxImg,e.dispatchEvent(t)}}},a={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{padding:"20px"}},[i("Button",{attrs:{type:"primary"},on:{click:e.handleGoAdd}},[e._v("\n        新增优惠券\n      ")]),e._v(" "),i("div",{staticStyle:{"margin-top":"20px"}},[i("Table",{ref:"appointment",attrs:{loading:e.loading,columns:e.columns,data:e.listData,"no-data-text":"暂无优惠券",border:""}}),e._v(" "),i("div",{staticStyle:{"margin-top":"15px",overflow:"hidden"}},[i("div",{staticStyle:{float:"right"}},[i("Page",{attrs:{total:e.totalcount,"page-size":e.page.pagesize,"page-size-opts":[10,20,30,40],"show-elevator":"","show-sizer":"",placement:"top","show-total":"",current:e.page.pageindex+1},on:{"on-change":e.indexChange,"on-page-size-change":e.sizeChange}})],1)])],1),e._v(" "),i("Modal",{attrs:{title:"确认提示",width:"300"},on:{"on-ok":e.updateConfirm},model:{value:e.showConfirm,callback:function(t){e.showConfirm=t},expression:"showConfirm"}},[e.showText?i("div",[e._v(e._s(e.showText))]):i("div",[i("span",[e._v("投放时长:")]),e._v(" "),i("InputNumber",{staticStyle:{width:"150px"},attrs:{min:1,step:1},model:{value:e.updateForm.expiretimes,callback:function(t){e.$set(e.updateForm,"expiretimes",t)},expression:"updateForm.expiretimes"}})],1)]),e._v(" "),i("Modal",{attrs:{title:"小程序码(优惠券)"},model:{value:e.loadBol,callback:function(t){e.loadBol=t},expression:"loadBol"}},[i("div",{staticStyle:{"text-align":"center"}},[i("img",{staticStyle:{width:"200px",height:"200px"},attrs:{src:e.wxImg,id:"myCanvas"}})]),e._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("Button",{attrs:{type:"primary",long:!0},on:{click:e.down}},[e._v("下载")])],1)])],1)},staticRenderFns:[]},o=i("VU/8")(n,a,!1,null,null,null);t.default=o.exports}});
//# sourceMappingURL=44.5a94987d6baf64d79a6b.js.map