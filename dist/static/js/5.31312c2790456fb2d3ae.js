webpackJsonp([5],{"+bbD":function(t,e,i){"use strict";var a=i("//Fk"),n=i.n(a),s={data:function(){return{showModal:!1,tableLoading:!1,columns:[],tagList:[],modal:{id:"",isAdd:!1,show:!1,title:"",name:""}}},mounted:function(){this.initHeader(),this.getTagList()},methods:{getTagList:function(){var t=this;this.$http.post(this.$api.tag_listall,{}).then(function(e){"1"==e.data.result&&(t.tagList=e.data.data,t.$emit("list-change",e.data.data.map(function(t){return t})))}).catch(function(t){})},handleAdd:function(){this.modal.isAdd=!0,this.modal.show=!0,this.modal.title="新建标签",this.modal.id=""},initHeader:function(){var t=this;this.columns=[{title:"标签名",key:"name"},{title:"操作",key:"operate",render:function(e,i){return e("div",[e("Button",{props:{type:"error",size:"small"},on:{click:function(){}}},"删除"),e("Button",{props:{type:"primary",size:"small"},on:{click:function(){t.modal.isAdd=!1,t.modal.show=!0,t.modal.title="标签编辑："+i.row.name,t.modal.id=i.row.id,t.modal.name=i.row.name}}},"编辑")])}}]},handleHidden:function(t){t||(this.modal.isAdd=!1,this.modal.title="",this.modal.name="",this.modal.id="")},handleSubmit:function(){var t=this,e=this.modal.name;if(e.length){var i=void 0;this.modal.isAdd?i=this.$http.post(this.$api.tag_add,{name:e}).then(function(t){return"1"==t.data.result||n.a.reject(t.data.msg)},function(t){return n.a.reject("网络请求错误")}):!this.modal.isAdd&&this.modal.id&&(i=this.$http.post(this.$api.tag_edit,{id:this.modal.id,name:e}).then(function(t){return"1"==t.data.result||n.a.reject(t.data.msg)},function(t){return n.a.reject("网络请求错误")})),i&&i.then(function(e){t.$Message.success("保存成功"),t.modal.show=!1,t.getTagList()}).catch(function(e){t.$Message.error(e)})}else this.$Message.error("标签名不能为空")}}},r={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("Button",{staticStyle:{width:"120px"},on:{click:function(e){t.showModal=!0}}},[t._v("管理商品标签")]),t._v(" "),i("Modal",{attrs:{title:"商品标签管理",width:"600"},model:{value:t.showModal,callback:function(e){t.showModal=e},expression:"showModal"}},[i("div",{staticStyle:{"max-height":"600px"}},[i("Button",{attrs:{type:"primary"},on:{click:t.handleAdd}},[t._v("新建标签")]),t._v(" "),i("Table",{staticStyle:{margin:"20px 0"},attrs:{"no-data-text":"暂无标签",columns:t.columns,data:t.tagList}})],1),t._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"})]),t._v(" "),i("Modal",{attrs:{title:t.modal.title},on:{"on-visible-change":t.handleHidden},model:{value:t.modal.show,callback:function(e){t.$set(t.modal,"show",e)},expression:"modal.show"}},[i("Input",{model:{value:t.modal.name,callback:function(e){t.$set(t.modal,"name","string"==typeof e?e.trim():e)},expression:"modal.name"}}),t._v(" "),i("div",{staticStyle:{"margin-top":"10px"}},[i("Button",{attrs:{type:"primary",size:"small"},on:{click:t.handleSubmit}},[t._v("确定")]),t._v(" "),i("Button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small"},on:{click:function(e){t.modal.show=!1}}},[t._v("取消")])],1),t._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"})],1)],1)},staticRenderFns:[]},o=i("VU/8")(s,r,!1,null,null,null);e.a=o.exports},Qfd2:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("//Fk"),n=i.n(a),s=i("woOf"),r=i.n(s),o=i("fZjL"),c=i.n(o),l=i("dc86"),u=i("mXpl"),d=i("mvHQ"),m=i.n(d),p=i("1lS0"),h={props:{skudata:{type:Array,default:function(){return[]}},itemid:{type:null}},data:function(){return{tableData:[],tableColumns:[],testVal:1}},components:{"number-input":p.a},watch:{skudata:{handler:function(t){this.formatTableHead(t)},deep:!0},testVal:function(t){}},mounted:function(){this.formatTableHead(this.skudata)},methods:{inputValue:function(t){this.testVal=t},confirm:function(t,e){var i=this;return new n.a(function(a,n){i.$Modal.confirm({title:e||"确认",content:t,onOk:function(){return a(!0)},onCancel:function(){return n(!1)}})})},formatTableHead:function(t){var e=this,i=[],a=[];t.forEach(function(t){var e={},n=JSON.parse(t.attrvalue);e.id=t.id,e.price=t.price,e.quantity=t.quantity,e=r()({},e,n),c()(n).forEach(function(t){-1==i.indexOf(t)&&i.push(t)}),a.push(e)});var n=[{key:"price",title:"价格",align:"center",render:function(t,i){return t("number-input",{props:{value:e.tableData[i.index].price},on:{change:function(t){e.tableData[i.index].price=t}}})}},{key:"quantity",title:"数量",align:"center",render:function(t,i){return t("number-input",{props:{value:e.tableData[i.index].quantity},on:{change:function(t){e.tableData[i.index].quantity=t}}})}},{title:"操作",key:"action",align:"center",width:150,render:function(t,i){return t("div",[t("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){var t=e.tableData[i.index];t.priceError||t.quantityError||e.confirm("此操作将会改变这条sku信息，请确认保存！","提示").then(function(){e.$http.post(e.$api.itemsku_edit,e.transferSubmitData(t)).then(function(t){e.$Message.success("保存成功！"),e.$emit("sku-change")}).catch(function(t){e.$Message.error(""+t)})}).catch(function(){})}}},"保存"),t("Button",{props:{type:"ghost",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.confirm("此操作将会删除这条sku信息，请确认保存！","提示").then(function(){e.$http.post(e.$api.itemsku_del,{itemid:e.itemid,skuid:i.row.id}).then(function(t){e.$Message.success("删除成功！"),e.$emit("sku-change")}).catch(function(t){e.$Message.error(""+t)})}).catch(function(){})}}},"删除")])}}],s=i.map(function(t){return{key:t,title:t,align:"center"}});this.tableColumns=s.concat(n),this.tableData=a},transferSubmitData:function(t){var e={},i={},a=["price","quantity","priceError","quantityError","id"];return e.skuid=t.id,e.itemid=this.itemid,e.price=t.price,e.quantity=t.quantity,c()(t).forEach(function(e){-1==a.indexOf(e)&&(i[e]=t[e])}),e.attrvalue=m()(i),e}}},f={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("Table",{attrs:{border:"",columns:this.tableColumns,data:this.tableData}})],1)},staticRenderFns:[]};var g=i("VU/8")(h,f,!1,function(t){i("R5yH")},null,null).exports,v=i("+bbD"),b={data:function(){return{item:{id:"",title:"",cateid:"",itemtype:1,marketprice:0,price:0,vipprice:0,oldprice:0,num:0,picurl:"",description:"",isrecommend:0,ishidden:0,itemmodel:0,istop:0,seckillbegin:"",seckillend:""},ruleValidate:{title:[{required:!0,message:"标题名称不能为空！",trigger:"blur"}],itemtype:[{type:"number",required:!0,message:"请选择商品类型",trigger:"blur"}],description:[{required:!0,message:"请输入商品介绍",trigger:"blur"}]},categoryList:[],itempicture:[],itemsku:[],tags:[],tagList:[]}},components:{"single-uploader":l.a,"swiper-uploader":u.a,"sku-table":g,"item-tags":v.a},mounted:function(){this.$sitemap.prvname="商品管理",this.$sitemap.currname="编辑商品",this.getDetail()},methods:{handleTaglist:function(t){this.tagList=t},getDetail:function(){var t=this,e={itemid:this.$route.query.id};t.$http.post(this.$api.item_detail,e).then(function(e){var i=e.data.data;"1"==e.data.result&&i?t.item=i:t.$Message.error(e.data.msg)}).catch(function(e){t.$Message.error("服务器异常")})},getItemDetail:function(t){var e=this;this.$http.post(this.$api.item_detail,{itemid:t}).then(function(t){t.data.data&&(c()(e.item).forEach(function(i){e.item[i]=t.data.data.item[i]}),e.tags=t.data.data.item.tags.map(function(t){return t.id}),e.itempicture=t.data.data.itempicture,e.itemsku=t.data.data.itemsku)})},formatItem:function(){var t=this,e={};return c()(this.item).forEach(function(i){switch(i){case"seckillbegin":case"seckillend":t.item[i]&&(e[i+"s"]=Date.parse(t.item[i])/1e3);break;default:e[i]=t.item[i]}}),e},handleSubmit:function(t){var e=this;this.$refs[t].validate(function(t){t?e.confirm("您对商品的修改将会被保存,请确认保存","提示").then(function(){e.postItemEdit(e.formatItem()).then(function(t){"1"==t.data.result?(e.$router.push("/item/list"),e.$Message.success("保存成功！")):e.$Message.error(t.data.msg)}).catch(function(t){e.$Message.error("保存失败！")})}).catch(function(){}):e.$Message.error("请输入正确的格式")})},handleReset:function(t){this.$router.push("/item/list")},updateContent:function(t){this.item.description=t},postItemEdit:function(t){return this.$http.post(this.$api.item_edit,r()({},t,{signescape:["description"]}))},getCategoryList:function(){var t=this,e=this;this.$http.post(this.$api.category_list,{parentid:0}).then(function(t){e.categoryList=t.data.data?t.data.data:[]}).catch(function(e){t.$Message.error("error")})},handleImgChange:function(t){this.item.picurl=t.url},handleDelPic:function(t){var e=this;this.$http.post(this.$api.itempicture_del,{itemid:this.item.id,picid:t}).then(function(t){return e.getItemSwiperList(e.item.id)}).then(function(){e.$Message.success("删除成功")}).catch(function(t){e.$Message.error(t)})},handleAddPic:function(t){var e=this;this.$http.post(this.$api.itempicture_add,{itemid:this.item.id,picurl:t}).then(function(t){return e.getItemSwiperList(e.item.id)}).then(function(){e.$Message.success("添加成功")}).catch(function(t){e.$Message.error(t)})},handleChangePic:function(t){var e=this;this.$http.post(this.$api.itempicture_edit,{itemid:this.item.id,picid:t.id,picurl:t.picurl}).then(function(t){return e.getItemSwiperList(e.item.id)}).then(function(){e.$Message.success("更换成功")}).catch(function(t){e.$Message.error(t)})},getItemSwiperList:function(t){var e=this;this.$http.post(this.$api.itempicture_list,{itemid:t}).then(function(t){"1"==t.data.result?e.itempicture=t.data.data:n.a.reject(t.data.msg)}).catch(function(t){e.$Message.error(t)})},confirm:function(t,e){var i=this;return new n.a(function(a,n){i.$Modal.confirm({title:e||"确认",content:t,onOk:function(){return a(!0)},onCancel:function(){return n(!1)}})})},handleSkuChange:function(){var t=this;this.$http.post(this.$api.itemsku_list,{itemid:this.item.id}).then(function(e){t.itemsku=e.data.data})}}},$={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{margin:"20px"}},[i("Form",{ref:"formValidate",attrs:{model:t.item,rules:t.ruleValidate,"label-position":"left","label-width":130}},[i("FormItem",{attrs:{label:"商品名称",prop:"title"}},[i("Input",{attrs:{placeholder:"请输入商品名称",size:"large"},model:{value:t.item.title,callback:function(e){t.$set(t.item,"title",e)},expression:"item.title"}})],1),t._v(" "),i("FormItem",{attrs:{label:"商品类型",prop:"itemtype"}},[i("RadioGroup",{model:{value:t.item.itemtype,callback:function(e){t.$set(t.item,"itemtype",e)},expression:"item.itemtype"}},[i("Radio",{attrs:{label:1}},[t._v("产品")])],1)],1),t._v(" "),i("FormItem",{attrs:{label:"市场价格",prop:"marketprice"}},[i("InputNumber",{attrs:{size:"large",min:0},model:{value:t.item.marketprice,callback:function(e){t.$set(t.item,"marketprice",e)},expression:"item.marketprice"}})],1),t._v(" "),i("FormItem",{attrs:{label:"出售价格",prop:"price"}},[i("InputNumber",{attrs:{size:"large",min:0},model:{value:t.item.price,callback:function(e){t.$set(t.item,"price",e)},expression:"item.price"}}),t._v(" "),i("span",{staticStyle:{color:"#ccc","margin-left":"20px"}},[t._v("此价格为普通商品价格，活动价请移步营销活动设置")])],1),t._v(" "),i("FormItem",{attrs:{label:"VIP价格",prop:"vipprice"}},[i("InputNumber",{attrs:{size:"large",disabled:""},model:{value:t.item.vipprice,callback:function(e){t.$set(t.item,"vipprice",e)},expression:"item.vipprice"}})],1),t._v(" "),i("FormItem",{attrs:{label:"库存数量",prop:"num"}},[i("InputNumber",{attrs:{size:"large",min:0},model:{value:t.item.num,callback:function(e){t.$set(t.item,"num",e)},expression:"item.num"}})],1),t._v(" "),i("FormItem",{attrs:{label:"商品主图",prop:"picurl"}},[i("single-uploader",{attrs:{image:t.item.picurl},on:{change:t.handleImgChange}})],1),t._v(" "),i("FormItem",{attrs:{label:"上架商品",prop:"ishidden"}},[i("i-Switch",{attrs:{size:"large","true-value":0,"false-value":1},model:{value:t.item.ishidden,callback:function(e){t.$set(t.item,"ishidden",e)},expression:"item.ishidden"}},[i("span",{attrs:{slot:"open"},slot:"open"},[t._v("上架")]),t._v(" "),i("span",{attrs:{slot:"close"},slot:"close"},[t._v("下架")])])],1),t._v(" "),i("FormItem",{attrs:{label:"首页推荐",prop:"isrecommend"}},[i("i-Switch",{attrs:{size:"large","true-value":1,"false-value":0},model:{value:t.item.isrecommend,callback:function(e){t.$set(t.item,"isrecommend",e)},expression:"item.isrecommend"}},[i("span",{attrs:{slot:"open"},slot:"open"},[t._v("是")]),t._v(" "),i("span",{attrs:{slot:"close"},slot:"close"},[t._v("否")])])],1),t._v(" "),i("FormItem",{attrs:{label:"商品详情",prop:"description"}},[i("vue-editor",{attrs:{content:t.item.description},on:{change:t.updateContent}})],1),t._v(" "),i("FormItem",{attrs:{label:"商品sku"}},[i("sku-table",{attrs:{skudata:t.itemsku,itemid:t.item.id},on:{"sku-change":t.handleSkuChange}})],1),t._v(" "),i("FormItem",[i("Button",{staticStyle:{width:"120px"},attrs:{type:"primary",size:"large"},on:{click:function(e){t.handleSubmit("formValidate")}}},[t._v("保存修改")]),t._v(" "),i("Button",{staticStyle:{"margin-left":"8px",width:"80px"},attrs:{type:"ghost",size:"large"},on:{click:function(e){t.handleReset("formValidate")}}},[t._v("取消\n      ")])],1)],1)],1)},staticRenderFns:[]};var k=i("VU/8")(b,$,!1,function(t){i("eX5k")},null,null);e.default=k.exports},R5yH:function(t,e){},eX5k:function(t,e){}});
//# sourceMappingURL=5.31312c2790456fb2d3ae.js.map